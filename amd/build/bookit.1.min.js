define("mod_booking/bookit.1",["exports","core/ajax","core/templates","core/notification","local_wunderbyte_table/reload","./bookit"],(function(_exports,_ajax,_templates,_notification,_reload,_bookit){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.bookit=function(itemid,area,userid,data){console.log("run bookit"),_ajax.default.call([{methodname:"mod_booking_bookit",args:{itemid:itemid,area:area,userid:userid,data:JSON.stringify(data)},done:function(res){var skipreload=!1;document.querySelector(".booking-elective-component")&&window.location.reload();const jsonarray=JSON.parse(res.json),templates=res.template.split(","),buttons=document.querySelectorAll(_bookit.SELECTORS.BOOKITBUTTON+"[data-itemid='"+itemid+"'][data-area='"+area+"']"),promises=[];buttons.forEach((button=>{if(console.log("bookit values",button.dataset.nojs,res.status),skipreload=!0,1==button.dataset.nojs&&0==res.status)console.log("bookit skip",button.dataset.nojs,res.status);else{const arraytoreduce=[...jsonarray];1==res.status&&(skipreload=!1),templates.forEach((template=>{const data=arraytoreduce.shift(),datatorender=data.data??data,promise=_templates.default.renderForPromise(template,datatorender).then((_ref=>{let{html:html,js:js}=_ref;return _templates.default.replaceNode(button,html,js),!0})).catch((ex=>{_notification.default.addNotification({message:"failed rendering "+ex,type:"danger"})}));promises.push(promise)}))}})),Promise.all(promises).then((()=>{const backdrop=document.querySelector(_bookit.SELECTORS.STATICBACKDROP);return console.log("skipreload",skipreload),backdrop||skipreload||(0,_reload.reloadAllTables)(),!0})).catch((e=>{console.log(e)}))}}])},_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification)}));

//# sourceMappingURL=bookit.1.min.js.map